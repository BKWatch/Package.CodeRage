<?xml version="1.0" encoding="UTF-8"?>
<schema xmlns="http://www.w3.org/2001/XMLSchema"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:pr="http://www.coderage.com/2008/project"
  targetNamespace="http://www.coderage.com/2008/project"
  elementFormDefault="qualified">

  <annotation>
    <documentation>
      Defines the target-types "foo", "bar", and "testConfiguration"
    </documentation>
  </annotation>

  <include schemaLocation="../Resource/project.xsd"/>

  <simpleType name="version">
    <annotation>
      <documentation>
        Version format for test package manager
      </documentation>
    </annotation>
    <restriction base="string">
      <pattern value="(0|[1-9][0-9]*)(\.(0|[1-9][0-9]*))*"/>
    </restriction>
  </simpleType>

  <simpleType name="target-status">
    <annotation>
      <documentation>
        Type of the "status" attribute of a "foo" or "bar" target
      </documentation>
    </annotation>
    <restriction base="string">
      <enumeration value="success"/>
      <enumeration value="fail-parse"/>
      <enumeration value="fail-build"/>
    </restriction>
  </simpleType>

  <element name="foo" substitutionGroup="pr:target">
    <complexType>
      <choice minOccurs="0">
        <element ref="pr:info"/>
      </choice>
      <attribute name="status" type="pr:target-status"/>
      <attributeGroup ref="pr:targetAttributes"/>
    </complexType>
  </element>

  <element name="bar" substitutionGroup="pr:target">
    <complexType>
      <choice minOccurs="0">
        <element ref="pr:info"/>
      </choice>
      <attribute name="status" type="pr:target-status"/>
      <attributeGroup ref="pr:targetAttributes"/>
    </complexType>
  </element>

  <element name="testConfiguration" substitutionGroup="pr:target">
    <annotation>
      <documentation>
        Stores the expected output of a test, the list of targets to be built,
        and the configuration for the test package manager
      </documentation>
    </annotation>
    <complexType>
      <choice minOccurs="0" maxOccurs="unbounded">
        <element name="packageConfiguration">
          <annotation>
            <documentation>
              Data used by an instance of CodeRage\\Build\\Packages\\Test\\Configuration
            </documentation>
          </annotation>
          <complexType>
            <choice minOccurs="0" maxOccurs="unbounded">
              <element name="channel">
                <complexType>
                  <attribute name="url" type="anyURI" use="required"/>
                </complexType>
              </element>
              <element name="package">
                <complexType>
                  <choice minOccurs="0" maxOccurs="unbounded">
                    <element name="dependsOn">
                      <complexType>
                        <attribute name="name" type="string" use="required"/>
                        <attribute name="minVersion" type="pr:version"/>
                        <attribute name="maxVersion" type="pr:version"/>
                        <attribute name="channel" type="anyURI"/>
                      </complexType>
                    </element>
                  </choice>
                  <attribute name="name" type="string" use="required"/>
                  <attribute name="version" type="pr:version" use="required"/>
                  <attribute name="channel" type="anyURI"/>
                </complexType>
              </element>
            </choice>
            <attribute name="version" type="pr:version"/>
          </complexType>
        </element>
      </choice>
      <attribute name="status" type="boolean" use="required">
        <annotation>
          <documentation>
            true if the test project is expected to build successfully
          </documentation>
        </annotation>
      </attribute>
      <attribute name="targets">
        <annotation>
          <documentation>
            The list of targets to be built
          </documentation>
        </annotation>
        <simpleType>
          <list itemType="pr:identifier"/>
        </simpleType>
      </attribute>
      <attributeGroup ref="pr:targetAttributes"/>
    </complexType>
  </element>

</schema>
